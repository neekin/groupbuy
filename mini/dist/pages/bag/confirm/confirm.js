(wx["webpackJsonp"]=wx["webpackJsonp"]||[]).push([[130],{142:function(e,t,a){},238:function(e,t,a){"use strict";a.r(t);var n=a(3),c=a(7),r=a.n(c),l=a(11),o=a(6),i=a(0),s=a.n(i),u=a(2),m=a.n(u),d=a(1),p=a(59),f=a.n(p),b=a(19),v=a(27),g=a(46),h=a(34),E=m.a.cloud.database(),w=(E.command,100);function j(){return Object(h["d"])("freights",function(){var e=Object(l["a"])(r.a.mark((function e(t){var a;return r.a.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.next=2,E.collection("Freight").where({state:1}).limit(w).get();case 2:return a=e.sent,e.abrupt("return",a.data);case 4:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}())}var N=a(47),O=a(29),k=a(36),x=a(38);a(142);function _(e){var t=e.data;return s.a.createElement(d["f"],{className:"product-card"},s.a.createElement("van-card",{price:t.spec_price,title:t.product_title,thumb:t.product_thumb,thumbMode:"aspectFill",num:t.num},s.a.createElement(d["b"],{name:"desc"},s.a.createElement(d["f"],{className:"tags"},s.a.createElement("van-tag",{plain:!0,color:"#0e9a9c",size:"medium"},t.spec_title)))))}function y(e){var t=Object(g["a"])(),a=t.psns,n=Object(k["a"])(),c=Object(o["a"])(n,2),p=(c[0],c[1].removeProdcts),h=j(),E=h.data,w=Object(N["a"])("confirm"),y=w.data,C=Object(O["a"])(),P=C.data,T=C.mutate,D=Object(x["a"])(),R=Object(o["a"])(D,2),F=R[0],M=R[1].isLoading;Object(u["useDidShow"])((function(){T()})),Object(u["usePullDownRefresh"])((function(){m.a.stopPullDownRefresh()}));var S=Object(i["useState"])(null),z=Object(o["a"])(S,2),I=z[0],J=z[1],L="\u8bf7\u9009\u62e9\u6536\u8d27\u5730\u5740";I&&(L="".concat(I.userName," ").concat(I.telNumber," ").concat(I.provinceName).concat(I.cityName).concat(I.countyName).concat(I.detailInfo));var A=f()(a,(function(e,t){return e+t.spec_price*t.num}),0),B="normal",q=null;E&&I&&(q=0,E.map((function(e){e.type==B&&e.provinceName==I.provinceName&&(q=e.fee)})));var G=A+(q||0),H=function(){var e=Object(l["a"])(r.a.mark((function e(){var t,n,c,l,o,i,s;return r.a.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return t=P.openid,n=P.nickName,e.next=4,F({openid:t,nickName:n,address:I,psns:a,freight_type:B});case 4:c=e.sent,l=c.orderRes,o=c.errorMessage,l?(i=l._id,v["a"].success("\u63d0\u4ea4\u6210\u529f~"),m.a.redirectTo({url:"/pages/order/detail/detail?id=".concat(i)}),s=a.map((function(e){return e.spec_id})),p(s)):o&&Object(v["a"])(o);case 7:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),K=!1;return I&&!M||(K=!0),s.a.useEffect((function(){P&&P.openid||m.a.redirectTo({url:"/pages/login/login"})}),[]),P&&P.openid?s.a.createElement(d["f"],{className:"confirm"},s.a.createElement("van-sticky",null,s.a.createElement(b["a"],{back:!0,title:"\u786e\u8ba4\u8ba2\u5355",style:{backgroundColor:"white"}})),s.a.createElement(d["f"],{className:"detail"},y&&(null===y||void 0===y?void 0:y.length)>0?s.a.createElement("van-notice-bar",{"left-icon":y[0].icon,color:y[0].color,background:y[0].background,scrollable:!0,text:y[0].message,onClick:function(){y[0].needFeedback&&m.a.navigateToMiniProgram({appId:"wx8abaf00ee8c3202e",extraData:{id:"296232"}})}}):"",s.a.createElement("van-cell-group",null,s.a.createElement(d["f"],{className:"border__bottom"},s.a.createElement("van-cell",{center:!0,title:"\u6536\u8d27\u5730\u5740",isLink:!0,label:L,onClick:function(){m.a.authorize({scope:"scope.address"}).then((function(){m.a.chooseAddress().then((function(e){J(e)}))}))}})),s.a.createElement(d["f"],{className:"card-wapper_van-cell_last"},s.a.createElement("van-cell",{center:!0,title:"\u914d\u9001\u65b9\u5f0f",value:"\u666e\u901a\u5feb\u9012"}))),s.a.createElement(d["f"],{className:"list"},a.map((function(e){return s.a.createElement(_,{data:e})}))),s.a.createElement("van-cell-group",{title:" "},s.a.createElement("van-cell",{title:"\u5546\u54c1\u603b\u4ef7",value:"\uffe5".concat(A)}),null!=q?s.a.createElement("van-cell",{title:"\u8fd0\u8d39",value:"\uffe5".concat(q)}):"")),s.a.createElement("van-toast",{id:"van-toast"}),s.a.createElement("van-submit-bar",{disabled:K,loading:M,tip:!I&&"\u8bf7\u9009\u62e9\u6536\u8d27\u5730\u5740",price:100*G,buttonText:"\u63d0\u4ea4\u8ba2\u5355",buttonClass:"settle",priceClass:"settle-txt",onSubmit:H})):s.a.createElement(d["f"],null)}var C={navigationBarTitleText:"\u786e\u8ba4\u8ba2\u5355",enablePullDownRefresh:!0,usingComponents:{}};Page(Object(n["createPageConfig"])(y,"pages/bag/confirm/confirm",{},C||{}))}},[[238,0,3,1,2]]]);